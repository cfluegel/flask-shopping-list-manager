{% extends 'base.html' %}

{% block title %}{{ shopping_list.title }} - Geteilte Liste{% endblock %}

{% block content %}
<div class="content-wrapper">
  <!-- Info Banner for Shared List -->
  <div class="card" style="background-color: var(--color-info-bg); border-left: 4px solid var(--color-info); margin-bottom: 2rem;">
    <div style="display: flex; align-items: flex-start; gap: 1rem;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0; color: var(--color-info);">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      <div>
        <h3 style="margin: 0 0 0.25rem 0; font-size: 1rem;">Geteilte Einkaufsliste</h3>
        <p style="margin: 0; color: var(--color-text-secondary);">
          Diese Liste wurde von <strong>{{ shopping_list.owner.username }}</strong> mit dir geteilt.
          {% if not current_user.is_authenticated %}
            <a href="{{ url_for('main.login') }}" style="text-decoration: underline;">Melde dich an</a>, um Artikel hinzuzufügen oder zu bearbeiten.
          {% endif %}
        </p>
      </div>
    </div>
  </div>

  <!-- Page Header -->
  <div style="margin-bottom: 2rem;">
    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
      <h1 style="margin: 0;">{{ shopping_list.title }}</h1>
      <span class="badge badge-primary">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 2px;">
          <circle cx="18" cy="5" r="3"></circle>
          <circle cx="6" cy="12" r="3"></circle>
          <circle cx="18" cy="19" r="3"></circle>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
        </svg>
        Öffentlich geteilt
      </span>
    </div>
    <p class="text-muted" style="margin: 0;">Erstellt am {{ shopping_list.created_at.strftime('%d.%m.%Y') }}</p>
  </div>

  <!-- Add Item Section (Only for authenticated users) -->
  {% if can_edit and item_form %}
    <div class="add-item-section">
      <h3 style="margin-bottom: 1rem;">Neuen Artikel hinzufügen</h3>
      <form method="POST" action="{{ url_for('main.add_item', list_id=shopping_list.id) }}" class="form-inline" id="add-item-form">
        {{ item_form.hidden_tag() }}

        <div style="display: flex; gap: 0.5rem; flex: 1; flex-wrap: wrap;">
          {{ item_form.quantity(class="form-control form-control-sm", placeholder="Anzahl", style="max-width: 100px;") }}
          {{ item_form.name(class="form-control", placeholder="z.B. Milch, Brot, Äpfel...", style="flex: 1; min-width: 200px;") }}
        </div>

        <button type="submit" class="btn btn-primary" id="add-item-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Hinzufügen
        </button>
      </form>
    </div>
  {% endif %}

  <!-- Shopping Items List -->
  <div>
    <h3 style="margin-bottom: 1rem;">Artikel ({{ items|length }})</h3>

    {% if items %}
      <ul class="shopping-items" id="shopping-items">
        {% for item in items %}
          <li class="shopping-item {% if item.is_checked %}checked{% endif %}" data-item-id="{{ item.id }}">
            <!-- Checkbox (only if authenticated) -->
            {% if can_edit %}
              <input
                type="checkbox"
                class="shopping-item-checkbox"
                {% if item.is_checked %}checked{% endif %}
                data-item-id="{{ item.id }}"
                aria-label="Artikel als erledigt markieren">
            {% else %}
              <span style="display: inline-block; width: 24px; height: 24px; border: 2px solid var(--color-border); border-radius: 4px; flex-shrink: 0; {% if item.is_checked %}background-color: var(--color-success);{% endif %}"></span>
            {% endif %}

            <!-- Item Content -->
            <div class="shopping-item-content">
              <span class="shopping-item-quantity">{{ item.quantity }}</span>
              <span class="shopping-item-name">{{ item.name }}</span>
            </div>

            <!-- Actions (only if authenticated) -->
            {% if can_edit %}
              <div class="shopping-item-actions">
                <form method="POST" action="{{ url_for('main.delete_item', item_id=item.id) }}" style="display: inline;" class="delete-item-form">
                  <button
                    type="submit"
                    class="btn btn-icon btn-danger btn-sm"
                    aria-label="Artikel löschen"
                    onclick="return confirm('Artikel &quot;{{ item.name }}&quot; wirklich löschen?');">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                </form>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <!-- Empty State -->
      <div class="card" style="text-align: center; padding: 2rem;">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin: 0 auto 1rem; color: var(--color-text-muted);">
          <line x1="8" y1="6" x2="21" y2="6"></line>
          <line x1="8" y1="12" x2="21" y2="12"></line>
          <line x1="8" y1="18" x2="21" y2="18"></line>
          <line x1="3" y1="6" x2="3.01" y2="6"></line>
          <line x1="3" y1="12" x2="3.01" y2="12"></line>
          <line x1="3" y1="18" x2="3.01" y2="18"></line>
        </svg>
        <p class="text-muted" style="margin: 0;">Noch keine Artikel in dieser Liste.</p>
      </div>
    {% endif %}
  </div>

  <!-- Login Prompt for Non-Authenticated Users -->
  {% if not current_user.is_authenticated %}
    <div class="card" style="margin-top: 2rem; text-align: center; padding: 2rem; background-color: var(--color-accent);">
      <h3 style="margin-bottom: 0.5rem;">Möchtest du mithelfen?</h3>
      <p class="text-muted" style="margin-bottom: 1.5rem;">Melde dich an, um Artikel hinzuzufügen oder abzuhaken.</p>
      <a href="{{ url_for('main.login', next=request.path) }}" class="btn btn-primary">
        Jetzt anmelden
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
